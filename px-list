<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>전국 군마트 지도</title>
    <style>
        #map { width: 100%; height: 400px; }
    </style>
</head>
<body>
    <h1>전국 군마트 지도</h1>
    <div id="map"></div>

    <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=e4ac3ab4ba210c95746afaa017f247ef"></script>
    <script>
        // 카카오맵 초기화
        var mapContainer = document.getElementById('map'),
            mapOption = {
                center: new kakao.maps.LatLng(36.5, 127.5),
                level: 13
            };

        var map = new kakao.maps.Map(mapContainer, mapOption);

        // 군마트 정보를 가져오는 함수
        async function fetchMilitaryStores() {
            // 여기에 블로그 RSS 피드 URL을 입력하세요
            const rssUrl = 'https://www.k-lac.co.kr/feeds/posts/default/-/군마트';
            const response = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(rssUrl)}`);
            const data = await response.json();
            const parser = new DOMParser();
            const rss = parser.parseFromString(data.contents, 'text/xml');
            const entries = rss.querySelectorAll('entry');

            return Array.from(entries).map(entry => {
                const content = entry.querySelector('content').textContent;
                return extractStoreInfo(content);
            });
        }

        // HTML에서 군마트 정보 추출
        function extractStoreInfo(html) {
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            const storeDiv = doc.querySelector('.army-store');
            
            if (!storeDiv) return null;

            return {
                id: storeDiv.dataset.storeId,
                name: storeDiv.querySelector('.store-name').textContent,
                address: storeDiv.querySelector('.store-address').textContent,
                tel: storeDiv.querySelector('.store-tel').textContent,
                hours: storeDiv.querySelector('.store-hours').textContent,
                lat: parseFloat(storeDiv.querySelector('.store-lat').textContent),
                lng: parseFloat(storeDiv.querySelector('.store-lng').textContent)
            };
        }

        // 지도에 마커 추가
        function addMarker(store) {
            var marker = new kakao.maps.Marker({
                map: map,
                position: new kakao.maps.LatLng(store.lat, store.lng)
            });

            var infowindow = new kakao.maps.InfoWindow({
                content: `
                    <div style="padding:5px;">
                        <h3>${store.name}</h3>
                        <p>주소: ${store.address}</p>
                        <p>전화: ${store.tel}</p>
                        <p>영업시간: ${store.hours}</p>
                    </div>
                `
            });

            kakao.maps.event.addListener(marker, 'click', function() {
                infowindow.open(map, marker);
            });
        }

        // 메인 함수
        async function initMap() {
            const stores = await fetchMilitaryStores();
            stores.forEach(store => {
                if (store) addMarker(store);
            });
        }

        // 페이지 로드 시 실행
        initMap();
    </script>
</body>
</html>
